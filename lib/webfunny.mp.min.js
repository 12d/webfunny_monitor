!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){var n="jeffery_webmonitor",r="webfunnyVersionFlag",o="http://&&&www.webfunny.cn&&&",a=o+"/server/upMog",i="CUSTOMER_PV",s="CUS_LEAVE",c="JS_ERROR",u="LAST_BROWSE_DATE",g="WM_PAGE_ENTRY_TIME",h="WM_VISIT_PAGE_COUNT",f=[c,i];class d{static getUuid(){var e=d.formatDate((new Date).getTime(),"yMdhms");return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})+"-"+e}static getCustomerKey(){var e=d.getUuid(),t=wx.getStorageSync("monitorCustomerKey");return t||(wx.setStorage({key:"monitorCustomerKey",data:e}),t=e),t}static isTodayBrowse(e){var t=wx.getStorageSync(e),n=(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate();return t&&n==t?!(!t||n!=t):(wx.setStorageSync(e,n),!1)}static formatDate(e,t){var n=new Date(e).getFullYear(),r=new Date(e).getMonth()+1,o=new Date(e).getDate(),a=new Date(e).getHours(),i=new Date(e).getMinutes(),s=new Date(e).getSeconds();return r=r>9?r:"0"+r,o=o>9?o:"0"+o,a=a>9?a:"0"+a,i=i>9?i:"0"+i,s=s>9?s:"0"+s,t.replace("y",n).replace("M",r).replace("d",o).replace("h",a).replace("m",i).replace("s",s)}static getPageKey(){var e=wx.getStorageSync("monitorPageKey"),t=d.getUuid();return e&&/^[0-9a-z]{8}(-[0-9a-z]{4}){3}-[0-9a-z]{12}-\d{13}$/.test(e)||(e=t),e}static setPageKey(){wx.setStorage({key:"monitorPageKey",data:d.getUuid()})}static ajax(e,t,n,r,o){wx.request({method:e,url:t,data:n,header:{"Content-Type":"application/json"},success:e=>{"function"==typeof r&&r(e)},fail:e=>{"function"==typeof o&&o(e)}})}static encryptObj(e){if(e instanceof Array){for(var t=[],n=0;n<e.length;++n)t[n]=d.encryptObj(e[n]);return t}if(e instanceof Object){t={};for(var n in e)t[n]=d.encryptObj(e[n]);return t}return(e+="").length>50&&(e=e.substring(0,10)+"****"+e.substring(e.length-9,e.length)),e}static getDevice(){return wx.getSystemInfoSync()}static b64EncodeUnicode(e){var t,n,r,o,a,i,s,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=e,g="",h=0;for(u=d.utf8_encode(u);h<u.length;)o=(t=u.charCodeAt(h++))>>2,a=(3&t)<<4|(n=u.charCodeAt(h++))>>4,i=(15&n)<<2|(r=u.charCodeAt(h++))>>6,s=63&r,isNaN(n)?i=s=64:isNaN(r)&&(s=64),g=g+c.charAt(o)+c.charAt(a)+c.charAt(i)+c.charAt(s);return g}static utf8_encode(e){var t="";e=e.replace(/\r\n/g,"\n");for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}}class l{constructor(){var e=wx.getStorageSync("wmUserInfo"),t=e?JSON.parse(e):{},o=getCurrentPages().length?getCurrentPages()[0].route:"App Launched";this.wmVersion=r,this.happenTime=(new Date).getTime(),this.webMonitorId=n,this.simpleUrl=o,this.completeUrl=o,this.customerKey=d.getCustomerKey(),this.userId=t.userId,this.projectVersion=t.projectVersion||"",this.firstUserParam=d.b64EncodeUnicode(encodeURIComponent(t.userTag||"")),this.secondUserParam=d.b64EncodeUnicode(t.secondUserParam||"")}handleLogInfo(e,t){var n=wx.getStorageSync(e),r=n||[];r.push(t),wx.setStorage({data:r,key:e})}}class y extends l{constructor(e,t,n,r){super();var o=d.getDevice();this.uploadType=i,this.pageKey=d.getPageKey(),this.deviceName=o.model,this.os=o.system,this.browserName=o.platform,this.browserVersion=o.version,this.monitorIp="",this.country="",this.province="",this.city="",this.loadType=e,this.loadTime=t,this.newStatus=n,this.referrer=(r||"").split("?")[0].replace("#","")}}class p{constructor(e){var t=getCurrentPages().length?getCurrentPages()[0].route:"App Launched";this.uploadType=s,this.webMonitorId=n,this.leaveType=e,this.happenTime=(new Date).getTime(),this.simpleUrl=t,this.customerKey=d.getCustomerKey()}}class m extends l{constructor(e,t,n,r){super();var o=d.getDevice();this.uploadType=e,this.infoType=t,this.pageKey=d.getPageKey(),this.deviceName=o.model,this.os=o.system,this.browserName=o.platform,this.browserVersion=o.version,this.monitorIp="",this.country="china",this.province="",this.city="",this.errorMessage=d.b64EncodeUnicode(n),this.errorStack=d.b64EncodeUnicode(r),this.browserInfo=""}}var w="";function S(){var e=d.isTodayBrowse(u),t=(new Date).getTime();wx.setStorageSync(g,t);var n=getCurrentPages().length?getCurrentPages()[0].route:"App Launched",r=null,o=d.formatDate(t,"y-M-d"),s=encodeURIComponent(n),c=wx.getStorageSync(h);if(c){var f=c.split("$$$"),l=f[0],m=f[1],w=parseInt(f[2],10);o==m?s!=l&&1==w&&(wx.setStorageSync(h,s+"$$$"+o+"$$$2"),r=new p(2)):(wx.setStorageSync(h,s+"$$$"+o+"$$$1"),r=new p(1))}else wx.setStorageSync(h,s+"$$$"+o+"$$$1"),r=new p(1);var S=wx.getStorageSync("monitorCustomerKey");if(S){var x="",v=S?S.match(/\d{14}/g):[];if(v&&v.length>0){var b=v[0].match(/\d{2}/g),C=b[0]+b[1]+"-"+b[2]+"-"+b[3]+" "+b[4]+":"+b[5]+":"+b[6],P=new Date(C).getTime();x=(new Date).getTime()-P>300?0==e?"o_uv":"o":"n_uv"}}else x="n_uv",d.getCustomerKey();var T=new y("reload",0,x,"");if("n_uv"===x||"o_uv"===x){var U=[T,r];d.ajax("POST",a,U)}else T.handleLogInfo(i,T)}function x(){if(getCurrentPages().length){var e=getCurrentPages()[0].route;w!=e&&(S(),w=e)}}function v(e,t,n,r,o,a){x();var i=new m(c,e,t||"",a||"");i.handleLogInfo(c,i)}wx.webfunny=function(e){var t=0;setInterval(function(){if(x(),t>=40){for(var e=[],n=0;n<f.length;n++){var r=wx.getStorageSync(f[n]);e=e.concat(r)}e.length>0&&d.ajax("POST",a,e,function(){for(var e=0;e<f.length;e++)wx.setStorageSync(f[e],[])},function(){for(var e=0;e<f.length;e++)wx.setStorageSync(f[e],[])}),t=0}t++},200);var n=Object.assign({},e,{onLaunch:function(){},onShow:function(){},onHide:function(){},onError:function(){},onPageNotFound:function(){},onUnhandledRejection:function(){}}),r={};for(var o in n)switch(o){case"onLaunch":r.onLaunch=function(t){S(),e.onLaunch(t)};break;case"onShow":r.onShow=function(t){"function"==typeof e.onShow&&e.onShow(t)};break;case"onHide":r.onHide=function(t){"function"==typeof e.onHide&&e.onHide(t)};break;case"onError":r.onError=function(t){console.log(t.split("\n"));var n=t.split("\n")[2];getCurrentPages().length&&getCurrentPages()[0].route,v("on_error",n,0,0,0,t),"function"==typeof e.onError&&e.onError(t)};break;case"onPageNotFound":r.onPageNotFound=function(t){"function"==typeof e.onPageNotFound&&e.onPageNotFound(t)};break;case"onUnhandledRejection":r.onUnhandledRejection=function(t){"function"==typeof e.onUnhandledRejection&&e.onUnhandledRejection(t)};break;default:r[o]=e[o]}return r}}]);