!function(e){function t(n){if(o[n])return o[n].exports;var a=o[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var o={};t.m=e,t.c=o,t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t){!function(e){function t(){this.handleLogInfo=function(e,t){var o=localStorage[e]?localStorage[e]:"";switch(e){case N:localStorage[N]=o+JSON.stringify(t)+"$$$";break;case L:localStorage[L]=o+JSON.stringify(t)+"$$$";break;case U:localStorage[U]=o+JSON.stringify(t)+"$$$";break;case T:localStorage[T]=o+JSON.stringify(t)+"$$$";break;case O:localStorage[O]=o+JSON.stringify(t)+"$$$"}}}function o(){this.happenTime=(new Date).getTime(),this.webMonitorId=v,this.simpleUrl=e.location.href.split("?")[0].replace("#",""),this.completeUrl=encodeURIComponent(e.location.href),this.customerKey=I.getCustomerKey(),this.pageKey=I.getPageKey(),this.deviceName=P.deviceName,this.os=P.os+(P.osVersion?" "+P.osVersion:""),this.browserName=P.browserName,this.browserVersion=P.browserVersion,this.monitorIp="",this.country="china",this.province="",this.city="";var t=localStorage.wmUserInfo?JSON.parse(localStorage.wmUserInfo):"";this.userId=I.b64EncodeUnicode(t.userId||"0"),this.firstUserParam=I.b64EncodeUnicode(t.firstUserParam||"0"),this.secondUserParam=I.b64EncodeUnicode(t.secondUserParam||"0")}function n(e,t,n){o.apply(this),this.uploadType=e,this.loadType=t,this.loadTime=n}function a(e,t,n,a,r,i,s){o.apply(this),this.uploadType=e,this.behaviorType=t,this.className=I.b64EncodeUnicode(n),this.placeholder=I.b64EncodeUnicode(a),this.inputValue=I.b64EncodeUnicode(r),this.tagName=i,this.innerText=I.b64EncodeUnicode(encodeURIComponent(s))}function r(e,t,n){o.apply(this),this.uploadType=e,this.errorMessage=I.b64EncodeUnicode(t),this.errorStack=I.b64EncodeUnicode(n),this.browserInfo=C}function i(e,t,n,a,r,i){o.apply(this),this.uploadType=e,this.httpUrl=I.b64EncodeUnicode(t),this.status=n,this.statusText=a,this.statusResult=r,this.happenTime=i}function s(e,t,n){o.apply(this),this.uploadType=e,this.description=I.b64EncodeUnicode(t),this.screenInfo=n}function c(){var t=e.location.href.split("?")[0].replace("#","");m!=t&&(l(),m=t)}function l(){I.setPageKey();const e=new n(O,"none",0);e.handleLogInfo(O,e)}function d(){function t(e,t,o,n,a){c();var i=e||"",s=a||"",l="";if(-1==": Script error.".toLowerCase().indexOf("script error")){i&&(l=JSON.stringify(s).split(": ")[0].replace('"',""));var d=new r(L,l+": "+i,s);d.handleLogInfo(L,d),setTimeout(function(){-1==g.indexOf(i)&&(g.push(i),I.screenShot(document.body,i))},500)}}var o=console.error;console.error=function(){var e=arguments[0]&&arguments[0].message,n=x,a=arguments[0]&&arguments[0].stack;return a||(a=arguments[0]),!h&&t(e,n,0,0,a),o.apply(console,arguments)},e.onerror=function(e,o,n,a,r){h=!0,t(e,o,n,a,r?r.stack:null)}}function u(){function t(t){var o=new CustomEvent(t,{detail:this});e.dispatchEvent(o)}function o(){var e=new n;return e.addEventListener("abort",function(){t.call(this,"ajaxAbort")},!1),e.addEventListener("error",function(){t.call(this,"ajaxError")},!1),e.addEventListener("load",function(){t.call(this,"ajaxLoad")},!1),e.addEventListener("loadstart",function(){t.call(this,"ajaxLoadStart")},!1),e.addEventListener("progress",function(){t.call(this,"ajaxProgress")},!1),e.addEventListener("timeout",function(){t.call(this,"ajaxTimeout")},!1),e.addEventListener("loadend",function(){t.call(this,"ajaxLoadEnd")},!1),e.addEventListener("readystatechange",function(){t.call(this,"ajaxReadyStateChange")},!1),e}var n=e.XMLHttpRequest;e.XMLHttpRequest=o,e.addEventListener("ajaxLoadStart",function(e){var t=(new Date).getTime();setTimeout(function(){var o=e.detail.responseURL,n=e.detail.status,a=e.detail.statusText;if(o&&-1==o.indexOf(S)){var r=new i(U,o,n,a,"发起请求",t);r.handleLogInfo(U,r)}},2e3)}),e.addEventListener("ajaxLoadEnd",function(e){var t=(new Date).getTime(),o=e.detail.responseURL,n=e.detail.status,a=e.detail.statusText;if(o&&-1==o.indexOf(S)){var r=new i(U,o,n,a,"请求返回",t);r.handleLogInfo(U,r)}})}function p(e){e&&e.record&&1==e.record&&(c(),document.onclick=function(e){var t="",o="",n="",r=e.target.tagName,i="";"svg"!=e.target.tagName&&"use"!=e.target.tagName&&(t=e.target.className,o=e.target.placeholder||"",n=e.target.value||"",i=e.target.innerText.replace(/\s*/g,""),i.length>200&&(i=i.substring(0,100)+"... ..."+i.substring(i.length-99,i.length-1)),i=i.replace(/\s/g,""));var s=new a(N,"click",t,o,n,r,i);s.handleLogInfo(N,s)})}function f(){this.getUuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},this.getCustomerKey=function(){var e=this.getUuid();return localStorage.monitorCustomerKey||(localStorage.monitorCustomerKey=e),localStorage.monitorCustomerKey},this.getPageKey=function(){var e=this.getUuid();return localStorage.monitorPageKey||(localStorage.monitorPageKey=e),localStorage.monitorPageKey},this.setPageKey=function(){localStorage.monitorPageKey=this.getUuid()},this.ajax=function(t,o,n,a,r){var i=e.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");i.open(t,o,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var e=JSON.parse(i.responseText);"function"==typeof a&&a(e)}else"function"==typeof r&&r()},i.send("data="+JSON.stringify(n))},this.screenShot=function(t,o){var n=t,a=n.offsetWidth,r=n.offsetHeight,i=document.createElement("canvas");i.style.display="none",i.width=.3*a,i.height=.3*r,i.getContext("2d").scale(.3,.3);var c={scale:.3,canvas:i,logging:!1,width:a,height:r,useCORS:!0};console.log(e.html2canvas),e.html2canvas&&e.html2canvas(t,c).then(function(e){var t=e.toDataURL("image/webp"),n=t.replace("data:image/webp;base64,",""),a=I.b64EncodeUnicode(n),r=new s(T,o,a);r.handleLogInfo(T,r)})},this.getDevice=function(){var t={},o=navigator.userAgent,n=o.match(/(Android);?[\s\/]+([\d.]+)?/),a=o.match(/(iPad).*OS\s([\d_]+)/),r=o.match(/(iPod)(.*OS\s([\d_]+))?/),i=!a&&o.match(/(iPhone\sOS)\s([\d_]+)/),s=o.match(/Android\s[\S\s]+Build\//);if(t.ios=t.android=t.iphone=t.ipad=t.androidChrome=!1,t.isWeixin=/MicroMessenger/i.test(o),t.os="web",t.deviceName="PC",n&&(t.os="android",t.osVersion=n[2],t.android=!0,t.androidChrome=o.toLowerCase().indexOf("chrome")>=0),(a||i||r)&&(t.os="ios",t.ios=!0),i&&!r&&(t.osVersion=i[2].replace(/_/g,"."),t.iphone=!0),a&&(t.osVersion=a[2].replace(/_/g,"."),t.ipad=!0),r&&(t.osVersion=r[3]?r[3].replace(/_/g,"."):null,t.iphone=!0),t.ios&&t.osVersion&&o.indexOf("Version/")>=0&&"10"===t.osVersion.split(".")[0]&&(t.osVersion=o.toLowerCase().split("version/")[1].split(" ")[0]),t.iphone){t.deviceName="iphone";var c=e.screen.width,l=e.screen.height;320===c&&480===l?t.deviceName="iphone 4":320===c&&568===l?t.deviceName="iphone 5/SE":375===c&&667===l?t.deviceName="iphone 6/7/8":414===c&&736===l?t.deviceName="iphone 6/7/8 Plus":375===c&&812===l&&(t.deviceName="iphone X")}else if(t.ipad)t.deviceName="ipad";else if(s){var d=s[0],u=d.split(";")[1].replace(/Build\//g,"");t.deviceName=u.replace(/(^\s*)|(\s*$)/g,"")}if(-1==o.indexOf("Mobile")){var p=navigator.userAgent.toLowerCase(),f=/msie [\d.]+;/gi,h=/firefox\/[\d.]+/gi,g=/chrome\/[\d.]+/gi,m=/safari\/[\d.]+/gi;if(t.browserName="未知",p.indexOf("msie")>0){var v=p.match(f)[0];t.browserName=v.split("/")[0],t.browserVersion=v.split("/")[1]}if(p.indexOf("firefox")>0){var v=p.match(h)[0];t.browserName=v.split("/")[0],t.browserVersion=v.split("/")[1]}if(p.indexOf("safari")>0&&p.indexOf("chrome")<0){var v=p.match(m)[0];t.browserName=v.split("/")[0],t.browserVersion=v.split("/")[1]}if(p.indexOf("chrome")>0){var v=p.match(g)[0];t.browserName=v.split("/")[0],t.browserVersion=v.split("/")[1]}}return t.webView=(i||a||r)&&o.match(/.*AppleWebKit(?!.*Safari)/i),t},this.loadJs=function(e,t){var o=document.createElement("script");o.async=1,o.src=e,o.onload=t;var n=document.getElementsByTagName("script")[0];return n.parentNode.insertBefore(o,n),n},this.b64EncodeUnicode=function(e){try{return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))}catch(t){return e}}}localStorage||(e.localStorage=new Object),localStorage.wmUserInfo="";var h=!1,g=[],m=e.location.href.split("?")[0].replace("#",""),v="mcl_webmonitor",w=-1===e.location.href.indexOf("https")?"http://":"https://",x=e.location.href,y=-1==x.indexOf("localhost")?w+"www.webfunny.cn":w+"localhost:8010",S="/api/v1/uploadLog",b=y+"/api/v1/uploadLog",E=y+"",O="CUSTOMER_PV",U="HTTP_LOG",L="JS_ERROR",T="SCREEN_SHOT",N="ELE_BEHAVIOR",C=e.navigator.userAgent,I=new f,P=I.getDevice();localStorage.wmUserInfo&&JSON.parse(localStorage.wmUserInfo);n.prototype=new t,a.prototype=new t,r.prototype=new t,i.prototype=new t,s.prototype=new t,function(){l(),p({record:1}),d(),u();var e=0;setInterval(function(){if(c(),e>=25){var t=(localStorage[N]||"")+(localStorage[L]||"")+(localStorage[U]||"")+(localStorage[T]||"")+(localStorage[O]||"");t&&(localStorage[N]="",localStorage[L]="",localStorage[U]="",localStorage[T]="",localStorage[O]="",I.ajax("POST",b,{logInfo:t},function(e){},function(){})),e=0}e++},200)}(),e.webfunny={wm_upload:function(t,o,n,a){var r=(new Date).toString(),i={createTime:encodeURIComponent(r),happenTime:(new Date).getTime(),uploadType:"WM_UPLOAD",simpleUrl:encodeURIComponent(t),webMonitorId:v,recordType:o,recordIndex:n,description:a},s=E,c=e.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.open("POST",s,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send("data="+JSON.stringify([i]))},wm_init_user:function(e,t,o){e||console.warn("userId 初始化值为0(不推荐) 或者 未初始化"),t||console.warn("firstParam 初始化值为0(不推荐) 或者 未初始化"),o||console.warn("secondParam 初始化值为0(不推荐) 或者 未初始化"),localStorage.wmUserInfo=JSON.stringify({userId:e,firstUserParam:t,secondUserParam:o})},wm_screen_shot:function(e){setTimeout(function(){I.screenShot(document.body,e)},500)}},function(){function t(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),o}if("function"==typeof e.CustomEvent)return!1;t.prototype=e.Event.prototype,e.CustomEvent=t}()}(window)}]);