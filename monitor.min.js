!function(e){function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}var t={};o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},o.p="",o(o.s=0)}([function(e,o){function t(){this.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var o=16*Math.random()|0;return("x"==e?o:3&o|8).toString(16)})}}function n(){var e=new t;localStorage.customerKey||(localStorage.customerKey=e.guid());var o=document.getElementById("webmonitor");o&&(d=o.getAttribute("monitor"));var n=-1!=u.indexOf("localhost")?p+"localhost:8001":p+"www.webfunny.cn";return{CUSTOMER_KEY:localStorage.customerKey,WEB_MONITOR_ID:d,BROWSER_INFO:window.navigator.userAgent,WEB_MONITOR_IGNORE_URL:n+"/server/common/uploadLogInfo",HTTP_UPLOAD_URI:n,HTTP_UPLOAD_RECORD_DATA:"",HTTP_UPLOAD_LOG_INFO:"/server/common/uploadLogInfo"}}function r(){function e(e){var o=new CustomEvent(e,{detail:this});window.dispatchEvent(o)}function o(){var o=new x;return o.addEventListener("abort",function(){e.call(this,"ajaxAbort")},!1),o.addEventListener("error",function(){e.call(this,"ajaxError")},!1),o.addEventListener("load",function(){e.call(this,"ajaxLoad")},!1),o.addEventListener("loadstart",function(){e.call(this,"ajaxLoadStart")},!1),o.addEventListener("progress",function(){e.call(this,"ajaxProgress")},!1),o.addEventListener("timeout",function(){e.call(this,"ajaxTimeout")},!1),o.addEventListener("loadend",function(){e.call(this,"ajaxLoadEnd")},!1),o.addEventListener("readystatechange",function(){e.call(this,"ajaxReadyStateChange")},!1),o}try{var t=new n,r=new s,c=new l,p="",g="",T=!1,v=!1;a("POST",t.HTTP_UPLOAD_URI+"/server/project/getProject",{webMonitorId:d},function(e){if(0===e.status){var o=e.data.project;if(!o||!o.recording||1!=o.recording)return void(v=!1);o&&o.recordBehavior&&1==o.recordBehavior&&(document.onclick=function(e){var o=u,n=e.target.className?e.target.className.replace(/\s/g,""):"",r=encodeURIComponent(e.target.placeholder||""),a=encodeURIComponent(e.target.value||""),i=e.target.tagName,s=encodeURIComponent(e.target.innerText);s.length>200&&(s=s.substring(0,200)+"..."),s=s.replace(/\s/g,"");var c={happenTime:(new Date).getTime(),uploadType:"ELE_BEHAVIOR",behaviorType:"click",webMonitorId:t.WEB_MONITOR_ID,customerKey:t.CUSTOMER_KEY,simpleUrl:o,className:n,placeholder:r,inputValue:a,tagName:i,innerText:s};R("ELE_BEHAVIOR",c)}),g=o.filterType,p=o.filterDomain,"include"===g&&-1!=u.indexOf(p)?v=!0:"exclude"===g&&-1==u.indexOf(p)&&(v=!0)}else console.log("未获取到项目信息")});var O=function(){f=setTimeout(function(){I(),clearTimeout(f),f=null},5e3)},R=function(e,o){if(m="",localStorage.webMonitorUploadMessageArray?localStorage.webMonitorUploadMessageArray=localStorage.webMonitorUploadMessageArray+JSON.stringify(o)+"$$$":localStorage.webMonitorUploadMessageArray=JSON.stringify(o)+"$$$",w=localStorage.webMonitorUploadMessageArray.split("$$$"),w=w.slice(0,w.length-1),w.length<30)return void(f||O());f&&(clearTimeout(f),f=null),I()},I=function(){if(w.length&&v){localStorage.webMonitorUploadMessageArray="";for(var e=0;e<w.length;e++){var o=localStorage.wmInitUser?JSON.parse(localStorage.wmInitUser):{},n=JSON.parse(w[e].replace(/undefined\{/g,"{"));n.customerKey=t.CUSTOMER_KEY,n.userId=o.userId||"",n.userName=o.userName||"",n.userType=o.userType||"",w[e]=n}a("POST",t.HTTP_UPLOAD_URI+"/server/common/uploadLogInfo",w,function(){w=new Array})}},_=function(e,o,n,r,a){var i=e||"",s=o||u,l=a||"",d=s&&s.split("?")[0],p=(new Date).toString(),m={happenTime:(new Date).getTime(),createTime:encodeURIComponent(p),uploadType:encodeURIComponent("JS_ERROR"),projectName:encodeURIComponent(""),simpleUrl:encodeURIComponent(d),location:encodeURIComponent(u),errorMessage:encodeURIComponent(i),errorStack:l,browserInfo:t.BROWSER_INFO,platformType:c.os||"web",webMonitorId:t.WEB_MONITOR_ID};R("JS_ERROR",m)};i(r);var h=console.error;console.error=function(){var e=arguments[0]&&arguments[0].message,o=u,t=arguments[0]&&arguments[0].stack;return t||(t=arguments[0]),!T&&_(e,o,0,0,t),h.apply(console,arguments)},window.onerror=function(e,o,t,n,r){var a=r?r.stack:null;T=!0,_(e,o,0,0,a)};var x=window.XMLHttpRequest,y=[];window.XMLHttpRequest=o,window.addEventListener("ajaxReadyStateChange",function(e){if(!e.detail.responseURL){var o={timeStamp:(new Date).getTime(),event:e};y.push(o)}}),window.addEventListener("ajaxLoadEnd",function(e){for(var o=0;o<y.length;o++)if(200==y[o].event.detail.status){var n=y[o].event.detail.responseURL,r=""+((new Date).getTime()-y[o].timeStamp)/1e3,a=(new Date).toString(),i=u,s=i&&i.split("?")[0],c={uploadType:encodeURIComponent("HTTP_LOG"),happenTime:(new Date).getTime(),createTime:encodeURIComponent(a),loadTime:encodeURIComponent(r),httpUrl:encodeURIComponent(n),location:encodeURIComponent(i),simpleUrl:s,webMonitorId:t.WEB_MONITOR_ID,customerKey:t.CUSTOMER_KEY};if(!n||-1!=n.indexOf(t.WEB_MONITOR_IGNORE_URL))continue;R("HTTP_LOG",c),y.splice(o,1)}}),window.addEventListener("ajaxError",function(e){var o=null,n=u;if(e._args){if(o="abort"===e._args[2]?"abort":"timeout"===e._args[2]?"timeout":e._args[0].status,m=e._args[1].url,m||(m=e.detail.responseURL),-1!=m.indexOf(t.WEB_MONITOR_IGNORE_URL))return}else o="offline";var r=(new Date).toString(),a={uploadType:encodeURIComponent("HTTP_ERROR"),happenTime:(new Date).getTime(),createTime:encodeURIComponent(r),httpStatus:encodeURIComponent(o),httpUrl:encodeURIComponent(m),location:encodeURIComponent(n),webMonitorId:t.WEB_MONITOR_ID};R("HTTP_ERROR",a)})}catch(e){console.error(e,"上报信息无法解析")}}function a(e,o,t,n,r){var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open(e,o,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=JSON.parse(a.responseText);"function"==typeof n&&n(e)}else"function"==typeof r&&r()},a.send("data="+JSON.stringify(t))}function i(e){var o=new t,r=new n,i=new l,s=window.location.href.split("?")[0].replace("#",""),c=o.guid(),d=(new Date).getTime(),p=(new Date).toString(),u={uploadType:"SCAN_TIME",happenTime:d,createTime:encodeURIComponent(p),customerKey:r.CUSTOMER_KEY,pageKey:c,webMonitorId:r.WEB_MONITOR_ID,simpleUrl:s,location:s,country:"中国",province:"",city:"",monitorIp:"",platform:i.os||"web",platformVersion:i.osVersion||"",deviceName:i.deviceName||"",browserName:i.browserName||"",browserVersion:i.browserVersion||"",loadType:"none",loadTime:0},m=localStorage.wmInitUser?JSON.parse(localStorage.wmInitUser):{},f=r.HTTP_UPLOAD_URI+r.HTTP_UPLOAD_LOG_INFO;if(u.customerKey=r.CUSTOMER_KEY,u.userId=m.userId||"",u.userName=m.userName||"",u.userType=m.userType||"",localStorage.monitorAddress){var w=localStorage.monitorAddress.split("$$$");u.province=w[0]||"",u.monitorIp=w[1]||"",a("POST",f,[u],function(){})}else setTimeout(function(){if(localStorage.monitorAddress){var e=localStorage.monitorAddress.split("$$$");u.province=e[0]||"",u.monitorIp=e[1]||""}a("POST",f,[u],function(){})},2e3);setInterval(function(){var e=window.location.href.split("?")[0].replace("#","");s!=e&&(p=(new Date).toString(),d=(new Date).getTime(),c=o.guid(),u.pageKey=c,u.createTime=p,u.happenTime=d,u.simpleUrl=e,u.location=e,a("POST",f,[u],function(){}),s=e)},1e3)}function s(){function e(){t=returnCitySN.cname||"",n=returnCitySN.cip||"",(t||n)&&(window.localStorage.monitorAddress=t+"$$$"+n)}var o="pv.sohu.com/cityjson?ie=utf-8",t="",n="";return function(){if(localStorage.monitorAddress){var r=localStorage.monitorAddress.split("$$$");t=r[0]||"",n=r[1]||""}else c(p+o,function(){e()})}(),{country:"中国",province:t,city:"",monitorIp:n,ipAddress:""}}function c(e,o){var t=document.createElement("script");t.async=1,t.src=e,t.onload=o;var n=document.getElementsByTagName("script")[0];return n.parentNode.insertBefore(t,n),n}function l(){var e={},o=navigator.userAgent,t=o.match(/(Android);?[\s\/]+([\d.]+)?/),n=o.match(/(iPad).*OS\s([\d_]+)/),r=o.match(/(iPod)(.*OS\s([\d_]+))?/),a=!n&&o.match(/(iPhone\sOS)\s([\d_]+)/),i=o.match(/Android\s[\S\s]+Build\//);if(e.ios=e.android=e.iphone=e.ipad=e.androidChrome=!1,e.isWeixin=/MicroMessenger/i.test(o),e.os="web",t&&(e.os="android",e.osVersion=t[2],e.android=!0,e.androidChrome=o.toLowerCase().indexOf("chrome")>=0),(n||a||r)&&(e.os="ios",e.ios=!0),a&&!r&&(e.osVersion=a[2].replace(/_/g,"."),e.iphone=!0),n&&(e.osVersion=n[2].replace(/_/g,"."),e.ipad=!0),r&&(e.osVersion=r[3]?r[3].replace(/_/g,"."):null,e.iphone=!0),e.ios&&e.osVersion&&o.indexOf("Version/")>=0&&"10"===e.osVersion.split(".")[0]&&(e.osVersion=o.toLowerCase().split("version/")[1].split(" ")[0]),e.iphone)e.deviceName="iphone";else if(e.ipad)e.deviceName="ipad";else if(i){var s=i[0],c=s.split(";")[1].replace(/Build\//g,"");e.deviceName=c.replace(/(^\s*)|(\s*$)/g,"")}if(-1==o.indexOf("Mobile")){var l=navigator.userAgent.toLowerCase(),d=/msie [\d.]+;/gi,p=/firefox\/[\d.]+/gi,u=/chrome\/[\d.]+/gi,m=/safari\/[\d.]+/gi;if(e.browserName="未知",l.indexOf("msie")>0){var f=l.match(d)[0];e.browserName=f.split("/")[0],e.browserVersion=f.split("/")[1]}if(l.indexOf("firefox")>0){var f=l.match(p)[0];e.browserName=f.split("/")[0],e.browserVersion=f.split("/")[1]}if(l.indexOf("safari")>0&&l.indexOf("chrome")<0){var f=l.match(m)[0];e.browserName=f.split("/")[0],e.browserVersion=f.split("/")[1]}if(l.indexOf("chrome")>0){var f=l.match(u)[0];e.browserName=f.split("/")[0],e.browserVersion=f.split("/")[1]}}return e.webView=(a||n||r)&&o.match(/.*AppleWebKit(?!.*Safari)/i),e}var d="jeffery_webmonitor",p=-1===window.location.href.indexOf("https")?"http://":"https://",u=window.location.href.split("?")[0].replace("#",""),m=null,f=null,w=null;localStorage||(window.localStorage=new Object),window.webfunny={wm_upload:function(e,o,t,r){var a=new n,i=(new Date).toString(),s={createTime:encodeURIComponent(i),happenTime:(new Date).getTime(),uploadType:"WM_UPLOAD",simpleUrl:encodeURIComponent(e),webMonitorId:a.WEB_MONITOR_ID,recordType:o,recordIndex:t,description:r},c=a.HTTP_UPLOAD_URI+a.HTTP_UPLOAD_RECORD_DATA,l=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");l.open("POST",c,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send("data="+JSON.stringify([s]))},wm_init_user:function(e,o,t){e||console.warn("userId 初始化值为0(不推荐) 或者 未初始化"),o||console.warn("userName 初始化值为0(不推荐) 或者 未初始化"),t||console.warn("userTpye 初始化值为0(不推荐) 或者 未初始化"),localStorage.wmInitUser=JSON.stringify({userId:e,userName:o,userType:t})}},function(){function e(e,o){o=o||{bubbles:!1,cancelable:!1,detail:void 0};var t=document.createEvent("CustomEvent");return t.initCustomEvent(e,o.bubbles,o.cancelable,o.detail),t}if("function"==typeof window.CustomEvent)return!1;e.prototype=window.Event.prototype,window.CustomEvent=e}(),new r}]);